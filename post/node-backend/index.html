<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.32.11"/><title data-react-helmet="true">Onichandame&#x27;s Home-Node.js Backend | Onichandame&#x27;s Home</title><meta data-react-helmet="true" name="description" content=""/><meta data-react-helmet="true" property="og:title" content="Node.js Backend"/><meta data-react-helmet="true" property="og:description" content=""/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Xiao Zhang"/><meta data-react-helmet="true" name="twitter:title" content="Node.js Backend"/><meta data-react-helmet="true" name="twitter:description" content=""/><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link as="script" rel="preload" href="/webpack-runtime-b8f61243929805fe6c86.js"/><link as="script" rel="preload" href="/framework-beda7bde9d7dca0755ce.js"/><link as="script" rel="preload" href="/4bdf9057-72ae28b8f8b272af811a.js"/><link as="script" rel="preload" href="/fb7d5399-9711c301a368b60666b0.js"/><link as="script" rel="preload" href="/d5b08420-ef0688e1927cb8badd4a.js"/><link as="script" rel="preload" href="/app-f6502f71dfa49857b242.js"/><link as="script" rel="preload" href="/c67bc222f24cf6cac9dade081f06b9686691a306-f93850fbf958b08d3ebd.js"/><link as="script" rel="preload" href="/component---src-template-blog-tsx-ef408eb56c2d463702e7.js"/><link as="fetch" rel="preload" href="/page-data/post/node-backend/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/440568431.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/840944156.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/899237799.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/899237799.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="position:fixed;top:0;right:0;bottom:0;left:0"><div style="position:relative;width:100%;height:100%;overflow:hidden"><canvas style="display:block"></canvas></div></div><div style="pointer-events:stroke;position:absolute;width:100vw"><div><header class="MuiPaper-root MuiAppBar-root MuiAppBar-positionStatic MuiAppBar-colorPrimary jss2 MuiPaper-elevation4"><div class="MuiToolbar-root MuiToolbar-regular MuiToolbar-gutters"><h6 class="MuiTypography-root MuiTypography-h6"><a class="jss7" href="/">Onichandame&#x27;s Home</a></h6><div class="jss3"><a class="jss7" href="/post"><span class="MuiTypography-root MuiTypography-button">blog</span></a></div><div class="jss3"><a class="jss7" href="/about"><span class="MuiTypography-root MuiTypography-button">about</span></a></div><div class="jss3"><a class="jss7" href="/contact"><span class="MuiTypography-root MuiTypography-button">contact</span></a></div><div style="flex-grow:1"></div><div style="flex-grow:1"></div><div><button class="MuiButtonBase-root MuiButton-root MuiButton-text" tabindex="0" type="button" aria-controls="language-selector" aria-haspopup="true"><span class="MuiButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English<svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></span></button></div><a class="MuiButtonBase-root MuiIconButton-root" tabindex="0" aria-disabled="false" href="https://github.com/onichandame"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .3a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2c-3.3.7-4-1.6-4-1.6-.6-1.4-1.4-1.8-1.4-1.8-1-.7.1-.7.1-.7 1.2 0 1.9 1.2 1.9 1.2 1 1.8 2.8 1.3 3.5 1 0-.8.4-1.3.7-1.6-2.7-.3-5.5-1.3-5.5-6 0-1.2.5-2.3 1.3-3.1-.2-.4-.6-1.6 0-3.2 0 0 1-.3 3.4 1.2a11.5 11.5 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.6 1.6.2 2.8 0 3.2.9.8 1.3 1.9 1.3 3.2 0 4.6-2.8 5.6-5.5 5.9.5.4.9 1 .9 2.2v3.3c0 .3.1.7.8.6A12 12 0 0 0 12 .3"></path></svg></span></a></div></header><main class="jss1"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column"><div class="MuiGrid-root MuiGrid-item"><h3 class="MuiTypography-root MuiTypography-h3">Node.js Backend</h3></div><div class="MuiGrid-root MuiGrid-item"><div class="MuiGrid-root MuiGrid-container MuiGrid-justify-xs-space-between"><div class="MuiGrid-root MuiGrid-item"><span class="MuiTypography-root MuiTypography-caption">onichandame</span></div><div class="MuiGrid-root MuiGrid-item"><span class="MuiTypography-root MuiTypography-caption">2020-8-5</span></div></div></div><div class="MuiGrid-root MuiGrid-item" style="padding:16px"><ul><li><a href="#post">POST</a><ul><li><a href="#formidable">Formidable</a></li><li><a href="#body-parser">Body Parser</a><ul><li><a href="#url-encoded">URL Encoded</a></li><li><a href="#json">JSON</a></li></ul></li></ul></li><li><a href="#gfw">GFW</a></li><li><a href="#authentication--authorization">Authentication &amp; Authorization</a><ul><li><a href="#auth-of-end-user">Auth of End User</a></li></ul></li></ul><p>Here I record the issues found during the development of backend services running in Node.js.</p><h1>POST</h1><p>There are 2 commonly used libraries to handle POST request: Formidable and Body-Parser.</p><h2>Formidable</h2><p>This tool can handle both field values and files. It is less popular than it&#x27;s counterpart though.</p><h2>Body Parser</h2><p>This tool can handle only field values. There are 2 formats: url encoded and json.</p><pre><code class="language-typescript">import bodyParser from &quot;body-parser&quot;
</code></pre><h3>URL Encoded</h3><pre><code class="language-typescript">server.use(bodyParser.urlencoded({ extended: true }))
</code></pre><h3>JSON</h3><p>The client must set header <code>Content-Type</code> to <code>application/json</code> for Body Parser to understand the request.</p><pre><code class="language-typescript">server.use(bodyParser.json())
</code></pre><h1>GFW</h1><p>For users in China, npm registry is often unavailable due to censorship. To solve this problem, the developers at Alibaba made a mirror registry which is synced with the official registry every 10 minutes. <a href="https://developer.aliyun.com/mirror/NPM?from=tnpm">This docs</a> tells how to use this registry.</p><h1>Authentication &amp; Authorization</h1><p>The auth(authentication and authorization) is a 2-fold problem. It includes the auth between services and the auth between the end user and the gateway service. The gateway service is the one that is exposed to the end users.</p><h2>Auth of End User</h2><p>There are several keystones to consider.</p><ul><li>The auth data, permanent(credentials) or temporary(session) must be horizontally scalable. To be specific, a user registered with or logged in a gateway service should not have to do the registration/login all over again when using another gateway instance of the same kind.</li><li>The different services in the same workflow or serving closely related customers should share the same auth pattern, so that every user in the same workflow is unique allowing business logic and workflow to change flexibly without conflict.</li><li>The dicision of registration pattern should be set once for all. For internal services, invitation pattern is higher on the list. In this pattern the permission pattern can be simplfied to focus on the business workflow as the security can rely on the real world relationships. For open registration model, the assumption that the end user is an experienced hacker infiltrating our service must be made.</li></ul><p>Some useful technologies.</p><ul><li>Passport.js</li><li>MongoDB/Mongoose</li><li>Express.js</li></ul></div></div></main><footer>Â© <!-- -->2021<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/post/node-backend";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-818af64753e5306e538b.js"],"app":["/app-f6502f71dfa49857b242.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-b0556ce5127c1a3e2490.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-a5780fd25427dba554e6.js"],"component---src-pages-contact-tsx":["/component---src-pages-contact-tsx-6e01bfbd9b9e3535a9b7.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-f451d7b1cde1ede15351.js"],"component---src-pages-post-tsx":["/component---src-pages-post-tsx-006378b48e558ceea283.js"],"component---src-template-blog-tsx":["/component---src-template-blog-tsx-ef408eb56c2d463702e7.js"],"component---src-template-resume-tsx":["/component---src-template-resume-tsx-25a9b3d394702968ca7c.js"]};/*]]>*/</script><script src="/polyfill-818af64753e5306e538b.js" nomodule=""></script><script src="/component---src-template-blog-tsx-ef408eb56c2d463702e7.js" async=""></script><script src="/c67bc222f24cf6cac9dade081f06b9686691a306-f93850fbf958b08d3ebd.js" async=""></script><script src="/app-f6502f71dfa49857b242.js" async=""></script><script src="/d5b08420-ef0688e1927cb8badd4a.js" async=""></script><script src="/fb7d5399-9711c301a368b60666b0.js" async=""></script><script src="/4bdf9057-72ae28b8f8b272af811a.js" async=""></script><script src="/framework-beda7bde9d7dca0755ce.js" async=""></script><script src="/webpack-runtime-b8f61243929805fe6c86.js" async=""></script></body></html>