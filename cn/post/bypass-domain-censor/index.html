<!DOCTYPE html><html lang="cn"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.32.13"/><title data-react-helmet="true">Onichandame的主页-绕过网站备案限制 | Onichandame的主页</title><meta data-react-helmet="true" name="description" content=""/><meta data-react-helmet="true" property="og:title" content="绕过网站备案限制"/><meta data-react-helmet="true" property="og:description" content=""/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="张筱"/><meta data-react-helmet="true" name="twitter:title" content="绕过网站备案限制"/><meta data-react-helmet="true" name="twitter:description" content=""/><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link as="script" rel="preload" href="/webpack-runtime-d43575d1244ba550701f.js"/><link as="script" rel="preload" href="/framework-beda7bde9d7dca0755ce.js"/><link as="script" rel="preload" href="/4bdf9057-4ff49e847c3bacb40ea0.js"/><link as="script" rel="preload" href="/fb7d5399-9711c301a368b60666b0.js"/><link as="script" rel="preload" href="/d5b08420-ef0688e1927cb8badd4a.js"/><link as="script" rel="preload" href="/app-9c8f0b3846f66c6a445e.js"/><link as="script" rel="preload" href="/c67bc222f24cf6cac9dade081f06b9686691a306-f93850fbf958b08d3ebd.js"/><link as="script" rel="preload" href="/component---src-template-blog-tsx-7bf2941daa81543f7ed1.js"/><link as="fetch" rel="preload" href="/page-data/cn/post/bypass-domain-censor/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/440568431.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/840944156.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/899237799.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/899237799.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="position:fixed;top:0;right:0;bottom:0;left:0"><div style="position:relative;width:100%;height:100%;overflow:hidden"><canvas style="display:block"></canvas></div></div><div style="pointer-events:stroke;position:absolute;width:100vw"><div><header class="MuiPaper-root MuiAppBar-root MuiAppBar-positionStatic MuiAppBar-colorPrimary jss2 MuiPaper-elevation4"><div class="MuiToolbar-root MuiToolbar-regular MuiToolbar-gutters"><h6 class="MuiTypography-root MuiTypography-h6"><a class="jss7" href="/cn">Onichandame的主页</a></h6><div class="jss3"><a class="jss7" href="/cn/post"><span class="MuiTypography-root MuiTypography-button">博客</span></a></div><div class="jss3"><a class="jss7" href="/cn/about"><span class="MuiTypography-root MuiTypography-button">关于</span></a></div><div class="jss3"><a class="jss7" href="/cn/contact"><span class="MuiTypography-root MuiTypography-button">联系</span></a></div><div style="flex-grow:1"></div><div style="flex-grow:1"></div><div><button class="MuiButtonBase-root MuiButton-root MuiButton-text" tabindex="0" type="button" aria-controls="language-selector" aria-haspopup="true"><span class="MuiButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文<svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></span></button></div><a class="MuiButtonBase-root MuiIconButton-root" tabindex="0" aria-disabled="false" href="https://github.com/onichandame"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .3a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2c-3.3.7-4-1.6-4-1.6-.6-1.4-1.4-1.8-1.4-1.8-1-.7.1-.7.1-.7 1.2 0 1.9 1.2 1.9 1.2 1 1.8 2.8 1.3 3.5 1 0-.8.4-1.3.7-1.6-2.7-.3-5.5-1.3-5.5-6 0-1.2.5-2.3 1.3-3.1-.2-.4-.6-1.6 0-3.2 0 0 1-.3 3.4 1.2a11.5 11.5 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.6 1.6.2 2.8 0 3.2.9.8 1.3 1.9 1.3 3.2 0 4.6-2.8 5.6-5.5 5.9.5.4.9 1 .9 2.2v3.3c0 .3.1.7.8.6A12 12 0 0 0 12 .3"></path></svg></span></a></div></header><main class="jss1"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column"><div class="MuiGrid-root MuiGrid-item"><h3 class="MuiTypography-root MuiTypography-h3">绕过网站备案限制</h3></div><div class="MuiGrid-root MuiGrid-item"><div class="MuiGrid-root MuiGrid-container MuiGrid-justify-xs-space-between"><div class="MuiGrid-root MuiGrid-item"><span class="MuiTypography-root MuiTypography-caption">onichandame</span></div><div class="MuiGrid-root MuiGrid-item"><span class="MuiTypography-root MuiTypography-caption">2020-12-20</span></div></div></div><div class="MuiGrid-root MuiGrid-item" style="padding:16px"><ul><li><a href="#%E5%8E%9F%E5%88%99">原则</a><ul><li><a href="#%E4%BD%BF%E7%94%A8%E9%9D%9E%E5%B8%B8%E8%A7%84%E7%AB%AF%E5%8F%A3">使用非常规端口</a></li><li><a href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">反向代理</a></li><li><a href="#tls">TLS</a></li></ul></li><li><a href="#%E6%8E%A8%E8%8D%90%E5%AE%9E%E8%B7%B5">推荐实践</a><ul><li><a href="#%E9%80%89%E6%8B%A9%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E5%95%86">选择服务提供商</a></li><li><a href="#%E6%BA%90%E7%AB%99%E7%9A%84-tls">源站的 TLS</a></li><li><a href="#%E5%8F%8D%E4%BB%A3">反代</a></li></ul></li></ul><p>在一些国家和地区，所有的网站、域名和 IP 都必须备案登记，否则不允许提供网站服务。这个规则有一些无可替代的好处，比如可以轻易追踪到诸如散播恐怖或黄色信息的网站的负责人。但对于开发者来说还是有一些不方便的地方。</p><p>举个例子，一个项目可能会需要一个测试服务器。如果测服也需要走完备案登记全流程的话，先不说等级被拒的可能性带来的额外支出，单单是走流程就需要额外延长开发周期。更为严重的是，每一个网站都需要注册独立的测服，因为管局需要定期检查网站的内容是否与备案时一致。</p><p>这里仅记录一些绕过域名和服务器监管的技术。这些记录可能会跟随现状实时变化。<strong>为了他人的自由，请在法律范围内使用这些技术！</strong></p><h1>原则</h1><p>本章记录解决问题所需的一些原则。基于这些原则可以有很多种具体实现方式。</p><h2>使用非常规端口</h2><p>监管通常采用的实时监控手段都基于对指向特定端口的流量的扫描，并将未备案的流量封锁。因此一个直观的方案就是采用非常规的端口以绕过监管。网络上端口的总数以及庞大多样的流量让全量实时分析监控成为一个不可能的任务，因此指向非常规端口的流量默认都会被放行。这也是所有延申方案的基石。</p><div class="mermaid" data-processed="true"><svg id="mermaid-1621874795011" width="100%" xmlns="http://www.w3.org/2000/svg" height="249" style="max-width:450px" viewBox="-50 -10 450 249"><style>#mermaid-1621874795011{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1621874795011 .error-icon{fill:#552222;}#mermaid-1621874795011 .error-text{fill:#552222;stroke:#552222;}#mermaid-1621874795011 .edge-thickness-normal{stroke-width:2px;}#mermaid-1621874795011 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1621874795011 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1621874795011 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1621874795011 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1621874795011 .marker{fill:#333333;stroke:#333333;}#mermaid-1621874795011 .marker.cross{stroke:#333333;}#mermaid-1621874795011 svg{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;}#mermaid-1621874795011 .actor{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1621874795011 text.actor &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795011 .actor-line{stroke:grey;}#mermaid-1621874795011 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-1621874795011 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-1621874795011 #arrowhead path{fill:#333;stroke:#333;}#mermaid-1621874795011 .sequenceNumber{fill:white;}#mermaid-1621874795011 #sequencenumber{fill:#333;}#mermaid-1621874795011 #crosshead path{fill:#333;stroke:#333;}#mermaid-1621874795011 .messageText{fill:#333;stroke:#333;}#mermaid-1621874795011 .labelBox{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1621874795011 .labelText,#mermaid-1621874795011 .labelText &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795011 .loopText,#mermaid-1621874795011 .loopText &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795011 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:hsl(259.6261682243,59.7765363128%,87.9019607843%);}#mermaid-1621874795011 .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid-1621874795011 .noteText,#mermaid-1621874795011 .noteText &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795011 .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-1621874795011 .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-1621874795011 .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-1621874795011:root{--mermaid-font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;}</style><g></g><g><line id="actor0" x1="75" y1="5" x2="75" y2="238" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="75" dy="0">Browser</tspan></text></g><g><line id="actor1" x1="275" y1="5" x2="275" y2="238" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="275" dy="0">Server</tspan></text></g><defs><marker id="arrowhead" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray:0, 0"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray:0, 0"></path></marker></defs><defs><marker id="filled-head" refX="18" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><text x="175" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family:&quot;trebuchet ms&quot;, verdana, arial, sans-serif;font-size:16px;font-weight:400">port 80</text><line x1="75" y1="109" x2="275" y2="109" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#crosshead)" style="fill:none"></line><text x="175" y="124" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family:&quot;trebuchet ms&quot;, verdana, arial, sans-serif;font-size:16px;font-weight:400">port 3000</text><line x1="75" y1="153" x2="275" y2="153" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill:none"></line><g><rect x="0" y="173" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="205.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="75" dy="0">Browser</tspan></text></g><g><rect x="200" y="173" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="205.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="275" dy="0">Server</tspan></text></g></svg></div><p>但是非常规的端口在使用中会带来一些不便。</p><ol><li>访问者需要在 url 中加入端口，如<code>www.example.com:8080</code>。</li><li>在很多浏览器种，一个正常的 url 会被自动升级成<code>https</code>。因此当输入<code>www.example.com</code>时，浏览器会自动导向<code>https://www.example.com</code>。但当使用非常规端口时就不会用这种便利。</li></ol><p>为了绕过上述不便，可以采用一些方案。</p><h2>反向代理</h2><p>为使用常规端口如 80 和 443，可以使用反向代理来实现。</p><div class="mermaid" data-processed="true"><svg id="mermaid-1621874795034" width="100%" xmlns="http://www.w3.org/2000/svg" height="249" style="max-width:650px" viewBox="-50 -10 650 249"><style>#mermaid-1621874795034{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1621874795034 .error-icon{fill:#552222;}#mermaid-1621874795034 .error-text{fill:#552222;stroke:#552222;}#mermaid-1621874795034 .edge-thickness-normal{stroke-width:2px;}#mermaid-1621874795034 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1621874795034 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1621874795034 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1621874795034 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1621874795034 .marker{fill:#333333;stroke:#333333;}#mermaid-1621874795034 .marker.cross{stroke:#333333;}#mermaid-1621874795034 svg{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;}#mermaid-1621874795034 .actor{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1621874795034 text.actor &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795034 .actor-line{stroke:grey;}#mermaid-1621874795034 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-1621874795034 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-1621874795034 #arrowhead path{fill:#333;stroke:#333;}#mermaid-1621874795034 .sequenceNumber{fill:white;}#mermaid-1621874795034 #sequencenumber{fill:#333;}#mermaid-1621874795034 #crosshead path{fill:#333;stroke:#333;}#mermaid-1621874795034 .messageText{fill:#333;stroke:#333;}#mermaid-1621874795034 .labelBox{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1621874795034 .labelText,#mermaid-1621874795034 .labelText &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795034 .loopText,#mermaid-1621874795034 .loopText &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795034 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:hsl(259.6261682243,59.7765363128%,87.9019607843%);}#mermaid-1621874795034 .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid-1621874795034 .noteText,#mermaid-1621874795034 .noteText &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795034 .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-1621874795034 .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-1621874795034 .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-1621874795034:root{--mermaid-font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;}</style><g></g><g><line id="actor0" x1="75" y1="5" x2="75" y2="238" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="75" dy="0">Browser</tspan></text></g><g><line id="actor1" x1="275" y1="5" x2="275" y2="238" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="275" dy="0">Reverse Proxy</tspan></text></g><g><line id="actor2" x1="475" y1="5" x2="475" y2="238" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="400" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="475" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="475" dy="0">Server</tspan></text></g><defs><marker id="arrowhead" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray:0, 0"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray:0, 0"></path></marker></defs><defs><marker id="filled-head" refX="18" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><text x="175" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family:&quot;trebuchet ms&quot;, verdana, arial, sans-serif;font-size:16px;font-weight:400">port 80</text><line x1="75" y1="109" x2="275" y2="109" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill:none"></line><text x="375" y="124" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family:&quot;trebuchet ms&quot;, verdana, arial, sans-serif;font-size:16px;font-weight:400">port 3000</text><line x1="275" y1="153" x2="475" y2="153" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill:none"></line><g><rect x="0" y="173" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="205.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="75" dy="0">Browser</tspan></text></g><g><rect x="200" y="173" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="205.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="275" dy="0">Reverse Proxy</tspan></text></g><g><rect x="400" y="173" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="475" y="205.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="475" dy="0">Server</tspan></text></g></svg></div><p>在这个设计中，用户或者说浏览器，将反代视为“服务器”。这个反代会为用户获取真实服务器上的信息并返回给用户。在这个场景中，如果反代已经被管局信任，则可以获得一个看起来与其它正常备案的服务器一样的服务器，在此过程中不需要与管局做任何交流。</p><h2>TLS</h2><p>基于上述的原则，一个反代和使用非常规端口的服务器已经可以提供完整的 HTTP 服务器。但是安全性仍然没有解决。TLS 加密的意义不仅在于防范黑客入侵，还能将流量从监管的眼中隐藏起来，因此可以降低被盯上的风险。</p><p>在上述的回路中，每个请求都需要 2 个独立的连接。这两个连接都需要不同的保密策略。</p><div class="mermaid" data-processed="true"><svg id="mermaid-1621874795019" width="100%" xmlns="http://www.w3.org/2000/svg" height="249" style="max-width:769px" viewBox="-50 -10 769 249"><style>#mermaid-1621874795019{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1621874795019 .error-icon{fill:#552222;}#mermaid-1621874795019 .error-text{fill:#552222;stroke:#552222;}#mermaid-1621874795019 .edge-thickness-normal{stroke-width:2px;}#mermaid-1621874795019 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1621874795019 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1621874795019 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1621874795019 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1621874795019 .marker{fill:#333333;stroke:#333333;}#mermaid-1621874795019 .marker.cross{stroke:#333333;}#mermaid-1621874795019 svg{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;}#mermaid-1621874795019 .actor{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1621874795019 text.actor &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795019 .actor-line{stroke:grey;}#mermaid-1621874795019 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-1621874795019 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-1621874795019 #arrowhead path{fill:#333;stroke:#333;}#mermaid-1621874795019 .sequenceNumber{fill:white;}#mermaid-1621874795019 #sequencenumber{fill:#333;}#mermaid-1621874795019 #crosshead path{fill:#333;stroke:#333;}#mermaid-1621874795019 .messageText{fill:#333;stroke:#333;}#mermaid-1621874795019 .labelBox{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1621874795019 .labelText,#mermaid-1621874795019 .labelText &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795019 .loopText,#mermaid-1621874795019 .loopText &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795019 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:hsl(259.6261682243,59.7765363128%,87.9019607843%);}#mermaid-1621874795019 .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid-1621874795019 .noteText,#mermaid-1621874795019 .noteText &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795019 .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-1621874795019 .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-1621874795019 .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-1621874795019:root{--mermaid-font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;}</style><g></g><g><line id="actor0" x1="75" y1="5" x2="75" y2="238" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="75" dy="0">Browser</tspan></text></g><g><line id="actor1" x1="294" y1="5" x2="294" y2="238" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="219" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="294" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="294" dy="0">Reverse Proxy</tspan></text></g><g><line id="actor2" x1="594" y1="5" x2="594" y2="238" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="519" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="594" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="594" dy="0">Server</tspan></text></g><defs><marker id="arrowhead" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray:0, 0"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray:0, 0"></path></marker></defs><defs><marker id="filled-head" refX="18" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><text x="185" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family:&quot;trebuchet ms&quot;, verdana, arial, sans-serif;font-size:16px;font-weight:400">CA trusted certificate</text><line x1="75" y1="109" x2="294" y2="109" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill:none"></line><text x="444" y="124" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family:&quot;trebuchet ms&quot;, verdana, arial, sans-serif;font-size:16px;font-weight:400">Reverse proxy trusted certificate</text><line x1="294" y1="153" x2="594" y2="153" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill:none"></line><g><rect x="0" y="173" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="205.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="75" dy="0">Browser</tspan></text></g><g><rect x="219" y="173" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="294" y="205.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="294" dy="0">Reverse Proxy</tspan></text></g><g><rect x="519" y="173" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="594" y="205.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="594" dy="0">Server</tspan></text></g></svg></div><p>反代的证书设置比较容易，许多提供商如 CloudFlare 都可以直接提供解决方案。</p><p>在服务器上安装的证书一定要能被反代信任。许多服务提供商都能为此提供免费的自签名证书。</p><h1>推荐实践</h1><p>本章记录我在实现上面的原则时采用过的一些实践。</p><h2>选择服务提供商</h2><p>最关键的一个组件就是反代。通常云服务提供商都能提供所有需要的功能。</p><p>当然有许多提供商以供选择，但我只用过 CloudFlare，也是最著名的一家。</p><p>CloudFlare 不仅是反代的提供商，它还能提供 DNS 服务。下面记录我如何开始使用 CloudFlare 管理我的站点。<a href="https://support.cloudflare.com/hc/en-us/articles/201720164-Creating-a-Cloudflare-account-and-adding-a-website#2YulMb5YJTVnMxgAgNWdS2">官方文档</a>中已经有所有的细节，我只需要重申一个与域名注册商有关的配置。</p><p>CloudFlare 可以与任何注册商配合，只需要调整域名服务器的设定即可。注册商的管理面板中的上游域名服务器应该采用 CloudFlare 提供的那些，并且将 NS 解析记录改成这些域名服务器。此项更改可能需要几个小时才能在全网生效。</p><h2>源站的 TLS</h2><p>在 CloudFlare 的语境中，真实的服务器被称为“源站”。为将源站的真实 IP 隐藏起来，默认会启动代理模式。所有的 DNS 记录都会指向同一个反代服务器，这个反代服务器会向源站获取信息并返回给用户。其拓扑结构已经在<a href="#principles">原则部分</a>讨论过。</p><p>一个尚未解决的问题是反代服务器与源站之间的流量的安全性。在这个通道中，CloudFlare 的反代作为客户端，而源站则是服务端。因此 TLS 证书需要安装在源站中并被反代所信任。幸运的是，CloudFlare 为所有在其平台管理的域名提供免费 TLS 证书。</p><div class="mermaid" data-processed="true"><svg id="mermaid-1621874795036" width="100%" xmlns="http://www.w3.org/2000/svg" height="205" style="max-width:616px" viewBox="-50 -10 616 205"><style>#mermaid-1621874795036{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1621874795036 .error-icon{fill:#552222;}#mermaid-1621874795036 .error-text{fill:#552222;stroke:#552222;}#mermaid-1621874795036 .edge-thickness-normal{stroke-width:2px;}#mermaid-1621874795036 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1621874795036 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1621874795036 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1621874795036 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1621874795036 .marker{fill:#333333;stroke:#333333;}#mermaid-1621874795036 .marker.cross{stroke:#333333;}#mermaid-1621874795036 svg{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;}#mermaid-1621874795036 .actor{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1621874795036 text.actor &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795036 .actor-line{stroke:grey;}#mermaid-1621874795036 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-1621874795036 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-1621874795036 #arrowhead path{fill:#333;stroke:#333;}#mermaid-1621874795036 .sequenceNumber{fill:white;}#mermaid-1621874795036 #sequencenumber{fill:#333;}#mermaid-1621874795036 #crosshead path{fill:#333;stroke:#333;}#mermaid-1621874795036 .messageText{fill:#333;stroke:#333;}#mermaid-1621874795036 .labelBox{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1621874795036 .labelText,#mermaid-1621874795036 .labelText &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795036 .loopText,#mermaid-1621874795036 .loopText &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795036 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:hsl(259.6261682243,59.7765363128%,87.9019607843%);}#mermaid-1621874795036 .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid-1621874795036 .noteText,#mermaid-1621874795036 .noteText &gt; tspan{fill:black;stroke:none;}#mermaid-1621874795036 .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-1621874795036 .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-1621874795036 .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-1621874795036:root{--mermaid-font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;}</style><g></g><g><line id="actor0" x1="127" y1="5" x2="127" y2="194" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="254" height="65" rx="3" ry="3" class="actor"></rect><text x="127" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="127" dy="0">site.example.com(Reverse Proxy)</tspan></text></g><g><line id="actor1" x1="410" y1="5" x2="410" y2="194" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="304" y="0" fill="#eaeaea" stroke="#666" width="212" height="65" rx="3" ry="3" class="actor"></rect><text x="410" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="410" dy="0">origin.example.com(Origin)</tspan></text></g><defs><marker id="arrowhead" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray:0, 0"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray:0, 0"></path></marker></defs><defs><marker id="filled-head" refX="18" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><text x="269" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family:&quot;trebuchet ms&quot;, verdana, arial, sans-serif;font-size:16px;font-weight:400">TLS certified by CloudFlare</text><line x1="127" y1="109" x2="410" y2="109" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill:none"></line><g><rect x="0" y="129" fill="#eaeaea" stroke="#666" width="254" height="65" rx="3" ry="3" class="actor"></rect><text x="127" y="161.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="127" dy="0">site.example.com(Reverse Proxy)</tspan></text></g><g><rect x="304" y="129" fill="#eaeaea" stroke="#666" width="212" height="65" rx="3" ry="3" class="actor"></rect><text x="410" y="161.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor:middle;font-size:14px;font-weight:400;font-family:Open-Sans, sans-serif"><tspan x="410" dy="0">origin.example.com(Origin)</tspan></text></g></svg></div><h2>反代</h2><p>在 CloudFlare 中，反代可以用许多方法实现。其中最方便的一种就是<a href="https://workers.cloudflare.com/">worker</a>。</p><p><a href="https://workers.cloudflare.com/">Worker</a>本质上是一种 CloudFlare 提供的无服务器技术。仅需几行代码即可启用一个简单的反代：</p><pre><code class="language-javascript">const ORIGIN = &quot;origin.example.com&quot;;
const PORT = `2096`;
addEventListener(&quot;fetch&quot;, (event) =&gt; {
  event.passThroughOnException();
  const url = new URL(event.request.url);
  url.port = PORT;
  url.hostname = ORIGIN;
  const request = new Request(url, event.request);
  return event.respondWith(fetch(request));
});
</code></pre><p>这个 worker 需要与路由（子域名）配合以提供完整方便的解决方案。否则其 url 会是一个非常长的随机字符串。</p></div></div></main><footer>© <!-- -->2021<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/cn/post/bypass-domain-censor";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-48d6d113cdbd8eaeb1e6.js"],"app":["/app-9c8f0b3846f66c6a445e.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-b0556ce5127c1a3e2490.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-a5780fd25427dba554e6.js"],"component---src-pages-contact-tsx":["/component---src-pages-contact-tsx-6e01bfbd9b9e3535a9b7.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-f451d7b1cde1ede15351.js"],"component---src-pages-post-tsx":["/component---src-pages-post-tsx-006378b48e558ceea283.js"],"component---src-template-blog-tsx":["/component---src-template-blog-tsx-7bf2941daa81543f7ed1.js"],"component---src-template-resume-tsx":["/component---src-template-resume-tsx-2363937b5174dac01ae5.js"]};/*]]>*/</script><script src="/polyfill-48d6d113cdbd8eaeb1e6.js" nomodule=""></script><script src="/component---src-template-blog-tsx-7bf2941daa81543f7ed1.js" async=""></script><script src="/c67bc222f24cf6cac9dade081f06b9686691a306-f93850fbf958b08d3ebd.js" async=""></script><script src="/app-9c8f0b3846f66c6a445e.js" async=""></script><script src="/d5b08420-ef0688e1927cb8badd4a.js" async=""></script><script src="/fb7d5399-9711c301a368b60666b0.js" async=""></script><script src="/4bdf9057-4ff49e847c3bacb40ea0.js" async=""></script><script src="/framework-beda7bde9d7dca0755ce.js" async=""></script><script src="/webpack-runtime-d43575d1244ba550701f.js" async=""></script></body></html>