<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.29.1"/><title data-react-helmet="true">Onichandame&#x27;s Home-Monorepo with YARN Workspace | Onichandame&#x27;s Home</title><meta data-react-helmet="true" name="description" content=""/><meta data-react-helmet="true" property="og:title" content="Monorepo with YARN Workspace"/><meta data-react-helmet="true" property="og:description" content=""/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Xiao Zhang"/><meta data-react-helmet="true" name="twitter:title" content="Monorepo with YARN Workspace"/><meta data-react-helmet="true" name="twitter:description" content=""/><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link as="script" rel="preload" href="/webpack-runtime-d10adb79bdd5453eb719.js"/><link as="script" rel="preload" href="/framework-beda7bde9d7dca0755ce.js"/><link as="script" rel="preload" href="/4bdf9057-0bb9c0f56db98bc1f503.js"/><link as="script" rel="preload" href="/fb7d5399-58798ebfc9c8cc593565.js"/><link as="script" rel="preload" href="/d5b08420-07f367315fbba8850a0e.js"/><link as="script" rel="preload" href="/app-a22ec1c5bb75fda00d04.js"/><link as="script" rel="preload" href="/c67bc222f24cf6cac9dade081f06b9686691a306-5cb5fd77d6c6846ab638.js"/><link as="script" rel="preload" href="/component---src-template-blog-tsx-dc3e87313bcd461c5423.js"/><link as="fetch" rel="preload" href="/page-data/post/yarn-workspace/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/440568431.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/840944156.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/899237799.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/899237799.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="position:fixed;top:0;right:0;bottom:0;left:0"><div style="position:relative;width:100%;height:100%;overflow:hidden"><canvas style="display:block"></canvas></div></div><div style="pointer-events:stroke;position:absolute;width:100vw"><div><header class="MuiPaper-root MuiAppBar-root MuiAppBar-positionSticky MuiAppBar-colorPrimary jss2 MuiPaper-elevation4"><div class="MuiToolbar-root MuiToolbar-regular MuiToolbar-gutters"><div class="MuiGrid-root MuiGrid-container MuiGrid-align-items-xs-center MuiGrid-justify-xs-space-between"><div class="MuiGrid-root MuiGrid-item"><div class="MuiGrid-root MuiGrid-container MuiGrid-spacing-xs-2 MuiGrid-align-items-xs-center"><div class="MuiGrid-root MuiGrid-item"><h6 class="MuiTypography-root MuiTypography-h6"><a class="jss6" href="/">Onichandame&#x27;s Home</a></h6></div><div class="MuiGrid-root MuiGrid-item"><a class="jss6" href="/post"><span class="MuiTypography-root MuiTypography-button">blog</span></a></div><div class="MuiGrid-root MuiGrid-item"><a class="jss6" href="/about"><span class="MuiTypography-root MuiTypography-button">about</span></a></div><div class="MuiGrid-root MuiGrid-item"><a class="jss6" href="/contact"><span class="MuiTypography-root MuiTypography-button">contact</span></a></div></div></div><div class="MuiGrid-root MuiGrid-item"><div class="MuiGrid-root MuiGrid-container MuiGrid-align-items-xs-center"><div class="MuiGrid-root MuiGrid-item"><div><button class="MuiButtonBase-root MuiButton-root MuiButton-text" tabindex="0" type="button" aria-controls="language-selector" aria-haspopup="true"><span class="MuiButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English<svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></span></button></div></div><div class="MuiGrid-root MuiGrid-item"><a class="MuiButtonBase-root MuiIconButton-root" tabindex="0" aria-disabled="false" href="https://github.com/onichandame"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .3a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2c-3.3.7-4-1.6-4-1.6-.6-1.4-1.4-1.8-1.4-1.8-1-.7.1-.7.1-.7 1.2 0 1.9 1.2 1.9 1.2 1 1.8 2.8 1.3 3.5 1 0-.8.4-1.3.7-1.6-2.7-.3-5.5-1.3-5.5-6 0-1.2.5-2.3 1.3-3.1-.2-.4-.6-1.6 0-3.2 0 0 1-.3 3.4 1.2a11.5 11.5 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.6 1.6.2 2.8 0 3.2.9.8 1.3 1.9 1.3 3.2 0 4.6-2.8 5.6-5.5 5.9.5.4.9 1 .9 2.2v3.3c0 .3.1.7.8.6A12 12 0 0 0 12 .3"></path></svg></span></a></div></div></div></div></div></header><main class="jss1"><div class="MuiGrid-root MuiGrid-container MuiGrid-spacing-xs-2 MuiGrid-direction-xs-column"><div class="MuiGrid-root MuiGrid-item"><h3 class="MuiTypography-root MuiTypography-h3">Monorepo with YARN Workspace</h3></div><div class="MuiGrid-root MuiGrid-item"><div class="MuiGrid-root MuiGrid-container MuiGrid-justify-xs-space-between"><div class="MuiGrid-root MuiGrid-item"><span class="MuiTypography-root MuiTypography-caption">onichandame</span></div><div class="MuiGrid-root MuiGrid-item"><span class="MuiTypography-root MuiTypography-caption">2020-12-16</span></div></div></div><div class="MuiGrid-root MuiGrid-item"><ul><li><a href="#different-versions-of-a-dependency">Different Versions of A Dependency</a></li></ul><p><a href="https://classic.yarnpkg.com/en/docs/workspaces/">YARN workspaces</a> is the most low-level technique to manage a monorepo. Although it came after another monorepo managing tool <a href="https://github.com/lerna/lerna">lerna</a>, it is as powerful as any of the competitors.</p><p>This article records some of the important findings during my experience with the <a href="https://classic.yarnpkg.com/en/docs/workspaces/">workspaces</a>. Hence there is not an introductory section here. For the basic concepts, see the <a href="https://classic.yarnpkg.com/en/docs/workspaces/">official docs</a>.</p><h1>Different Versions of A Dependency</h1><p>A very popular selling-point of monorepo is that all sub-packages can now share common dependencies of the same version. It is also easier to keep all the common dependencies updated to the same versions. However, in practice it is not as simple as expected.</p><p>In one of my monorepos, there are 2 packages. Both of them depends on the same dependency of the same version; but the nasty bit is that one of a dependencies of a package depends on a different version.</p><div class="mermaid" data-processed="true"><svg id="mermaid-1608693450298" width="100%" xmlns="http://www.w3.org/2000/svg" xmlnsXLink="http://www.w3.org/1999/xlink" height="230" style="max-width:215.24609375px" viewBox="-20 -20 215.24609375 230"><style>#mermaid-1608693450298{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1608693450298 .error-icon{fill:#552222;}#mermaid-1608693450298 .error-text{fill:#552222;stroke:#552222;}#mermaid-1608693450298 .edge-thickness-normal{stroke-width:2px;}#mermaid-1608693450298 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1608693450298 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1608693450298 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1608693450298 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1608693450298 .marker{fill:#333333;}#mermaid-1608693450298 .marker.cross{stroke:#333333;}#mermaid-1608693450298 svg{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;}#mermaid-1608693450298 g.classGroup text{fill:#9370DB;fill:#131300;stroke:none;font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:10px;}#mermaid-1608693450298 g.classGroup text .title{font-weight:bolder;}#mermaid-1608693450298 .classTitle{font-weight:bolder;}#mermaid-1608693450298 .node rect,#mermaid-1608693450298 .node circle,#mermaid-1608693450298 .node ellipse,#mermaid-1608693450298 .node polygon,#mermaid-1608693450298 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1608693450298 .divider{stroke:#9370DB;stroke:1;}#mermaid-1608693450298 g.clickable{cursor:pointer;}#mermaid-1608693450298 g.classGroup rect{fill:#ECECFF;stroke:#9370DB;}#mermaid-1608693450298 g.classGroup line{stroke:#9370DB;stroke-width:1;}#mermaid-1608693450298 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5;}#mermaid-1608693450298 .classLabel .label{fill:#9370DB;font-size:10px;}#mermaid-1608693450298 .relation{stroke:#333333;stroke-width:1;fill:none;}#mermaid-1608693450298 .dashed-line{stroke-dasharray:3;}#mermaid-1608693450298 #compositionStart,#mermaid-1608693450298 .composition{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693450298 #compositionEnd,#mermaid-1608693450298 .composition{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693450298 #dependencyStart,#mermaid-1608693450298 .dependency{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693450298 #dependencyStart,#mermaid-1608693450298 .dependency{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693450298 #extensionStart,#mermaid-1608693450298 .extension{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693450298 #extensionEnd,#mermaid-1608693450298 .extension{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693450298 #aggregationStart,#mermaid-1608693450298 .aggregation{fill:#ECECFF !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693450298 #aggregationEnd,#mermaid-1608693450298 .aggregation{fill:#ECECFF !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693450298 .edgeTerminals{font-size:11px;}#mermaid-1608693450298:root{--mermaid-font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;}#mermaid-1608693450298 class{fill:apa;}</style><g></g><defs><marker id="extensionStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 1,7 L18,13 V 1 Z"></path></marker></defs><defs><marker id="extensionEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 1,1 V 13 L18,7 Z"></path></marker></defs><defs><marker id="compositionStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="compositionEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="aggregationStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="aggregationEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="dependencyStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 5,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="dependencyEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><g id="classid-package1-0" class="classGroup" transform="translate(0,0 )"><rect x="0" y="0" width="56.03125" height="30" class=""></rect><text y="15" x="0"><tspan class="title" x="5">package1</tspan></text><line x1="0" y1="21" y2="21" x2="56.03125"></line><text x="5" y="31" fill="white" class="classText"></text><line x1="0" y1="26" y2="26" x2="56.03125"></line><text x="5" y="41" fill="white" class="classText"></text></g><g id="classid-dep1ver1-1" class="classGroup" transform="translate(10.8359375,80 )"><rect x="0" y="0" width="54.359375" height="30" class=""></rect><text y="15" x="0"><tspan class="title" x="5">dep1ver1</tspan></text><line x1="0" y1="21" y2="21" x2="54.359375"></line><text x="5" y="31" fill="white" class="classText"></text><line x1="0" y1="26" y2="26" x2="54.359375"></line><text x="5" y="41" fill="white" class="classText"></text></g><g id="classid-package2-2" class="classGroup" transform="translate(110.05078125,0 )"><rect x="0" y="0" width="56.03125" height="30" class=""></rect><text y="15" x="0"><tspan class="title" x="5">package2</tspan></text><line x1="0" y1="21" y2="21" x2="56.03125"></line><text x="5" y="31" fill="white" class="classText"></text><line x1="0" y1="26" y2="26" x2="56.03125"></line><text x="5" y="41" fill="white" class="classText"></text></g><g id="classid-dep2-3" class="classGroup" transform="translate(131.17578125,80 )"><rect x="0" y="0" width="33.78125" height="30" class=""></rect><text y="15" x="0"><tspan class="title" x="5">dep2</tspan></text><line x1="0" y1="21" y2="21" x2="33.78125"></line><text x="5" y="31" fill="white" class="classText"></text><line x1="0" y1="26" y2="26" x2="33.78125"></line><text x="5" y="41" fill="white" class="classText"></text></g><g id="classid-dep1ver2-4" class="classGroup" transform="translate(120.88671875,160 )"><rect x="0" y="0" width="54.359375" height="30" class=""></rect><text y="15" x="0"><tspan class="title" x="5">dep1ver2</tspan></text><line x1="0" y1="21" y2="21" x2="54.359375"></line><text x="5" y="31" fill="white" class="classText"></text><line x1="0" y1="26" y2="26" x2="54.359375"></line><text x="5" y="41" fill="white" class="classText"></text></g><path d="M28.015625,30L28.015625,34.166666666666664C28.015625,38.333333333333336,28.015625,46.666666666666664,29.057291666666668,55C30.098958333333332,63.333333333333336,32.182291666666664,71.66666666666667,33.223958333333336,75.83333333333333L34.265625,80" id="edge0" class="relation dashed-line" marker-end="url(#dependencyEnd)"></path><path d="M120.42822265625,30L115.52872721354167,34.166666666666664C110.62923177083333,38.333333333333336,100.83024088541667,46.666666666666664,90.40828450520833,55C79.986328125,63.333333333333336,68.94140625,71.66666666666667,63.4189453125,75.83333333333333L57.896484375,80" id="edge1" class="relation dashed-line" marker-end="url(#dependencyEnd)"></path><path d="M141.81640625,30L142.85807291666666,34.166666666666664C143.89973958333334,38.333333333333336,145.98307291666666,46.666666666666664,147.02473958333334,55C148.06640625,63.333333333333336,148.06640625,71.66666666666667,148.06640625,75.83333333333333L148.06640625,80" id="edge2" class="relation dashed-line" marker-end="url(#dependencyEnd)"></path><path d="M148.06640625,110L148.06640625,114.16666666666667C148.06640625,118.33333333333333,148.06640625,126.66666666666667,148.06640625,135C148.06640625,143.33333333333334,148.06640625,151.66666666666666,148.06640625,155.83333333333334L148.06640625,160" id="edge3" class="relation dashed-line" marker-end="url(#dependencyEnd)"></path></svg></div><p>The above diagram shows the relationships between packages and the dependencies I have once encountered. In this case, 2 versions of the <code>dep 1</code> hoisted and both need to be installed.</p><p>It happens that the version on which the <code>dep 2</code> depends was installed in the root, which brings a lot of troubles. For example, if the <code>dep 1</code> was typescript and you edited the codes using the tsserver plugin of VSCode, the tsserver would pick up the typescript installed in the root to type-check your codes in the packages. But when the packages are compiled, the typescipt compiler actually used is the ones they each directly depends on. Hence the codes that pass the IDE may break when compiled.</p><p>My solution to this problem is to pick the <code>dep 1</code> from the packages and install it in the root.</p><div class="mermaid" data-processed="true"><svg id="mermaid-1608693449931" width="100%" xmlns="http://www.w3.org/2000/svg" xmlnsXLink="http://www.w3.org/1999/xlink" height="310" style="max-width:306.421875px" viewBox="-20 -20 306.421875 310"><style>#mermaid-1608693449931{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1608693449931 .error-icon{fill:#552222;}#mermaid-1608693449931 .error-text{fill:#552222;stroke:#552222;}#mermaid-1608693449931 .edge-thickness-normal{stroke-width:2px;}#mermaid-1608693449931 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1608693449931 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1608693449931 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1608693449931 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1608693449931 .marker{fill:#333333;}#mermaid-1608693449931 .marker.cross{stroke:#333333;}#mermaid-1608693449931 svg{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;}#mermaid-1608693449931 g.classGroup text{fill:#9370DB;fill:#131300;stroke:none;font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:10px;}#mermaid-1608693449931 g.classGroup text .title{font-weight:bolder;}#mermaid-1608693449931 .classTitle{font-weight:bolder;}#mermaid-1608693449931 .node rect,#mermaid-1608693449931 .node circle,#mermaid-1608693449931 .node ellipse,#mermaid-1608693449931 .node polygon,#mermaid-1608693449931 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1608693449931 .divider{stroke:#9370DB;stroke:1;}#mermaid-1608693449931 g.clickable{cursor:pointer;}#mermaid-1608693449931 g.classGroup rect{fill:#ECECFF;stroke:#9370DB;}#mermaid-1608693449931 g.classGroup line{stroke:#9370DB;stroke-width:1;}#mermaid-1608693449931 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5;}#mermaid-1608693449931 .classLabel .label{fill:#9370DB;font-size:10px;}#mermaid-1608693449931 .relation{stroke:#333333;stroke-width:1;fill:none;}#mermaid-1608693449931 .dashed-line{stroke-dasharray:3;}#mermaid-1608693449931 #compositionStart,#mermaid-1608693449931 .composition{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693449931 #compositionEnd,#mermaid-1608693449931 .composition{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693449931 #dependencyStart,#mermaid-1608693449931 .dependency{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693449931 #dependencyStart,#mermaid-1608693449931 .dependency{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693449931 #extensionStart,#mermaid-1608693449931 .extension{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693449931 #extensionEnd,#mermaid-1608693449931 .extension{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693449931 #aggregationStart,#mermaid-1608693449931 .aggregation{fill:#ECECFF !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693449931 #aggregationEnd,#mermaid-1608693449931 .aggregation{fill:#ECECFF !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1608693449931 .edgeTerminals{font-size:11px;}#mermaid-1608693449931:root{--mermaid-font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;}#mermaid-1608693449931 class{fill:apa;}</style><g></g><defs><marker id="extensionStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 1,7 L18,13 V 1 Z"></path></marker></defs><defs><marker id="extensionEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 1,1 V 13 L18,7 Z"></path></marker></defs><defs><marker id="compositionStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="compositionEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="aggregationStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="aggregationEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="dependencyStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 5,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="dependencyEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><g id="classid-root-0" class="classGroup" transform="translate(118.9921875,0 )"><rect x="0" y="0" width="30.109375" height="30" class=""></rect><text y="15" x="0"><tspan class="title" x="5">root</tspan></text><line x1="0" y1="21" y2="21" x2="30.109375"></line><text x="5" y="31" fill="white" class="classText"></text><line x1="0" y1="26" y2="26" x2="30.109375"></line><text x="5" y="41" fill="white" class="classText"></text></g><g id="classid-package1-1" class="classGroup" transform="translate(0,80 )"><rect x="0" y="0" width="56.03125" height="30" class=""></rect><text y="15" x="0"><tspan class="title" x="5">package1</tspan></text><line x1="0" y1="21" y2="21" x2="56.03125"></line><text x="5" y="31" fill="white" class="classText"></text><line x1="0" y1="26" y2="26" x2="56.03125"></line><text x="5" y="41" fill="white" class="classText"></text></g><g id="classid-package2-2" class="classGroup" transform="translate(106.03125,80 )"><rect x="0" y="0" width="56.03125" height="30" class=""></rect><text y="15" x="0"><tspan class="title" x="5">package2</tspan></text><line x1="0" y1="21" y2="21" x2="56.03125"></line><text x="5" y="31" fill="white" class="classText"></text><line x1="0" y1="26" y2="26" x2="56.03125"></line><text x="5" y="41" fill="white" class="classText"></text></g><g id="classid-dep1ver1-3" class="classGroup" transform="translate(212.0625,80 )"><rect x="0" y="0" width="54.359375" height="30" class=""></rect><text y="15" x="0"><tspan class="title" x="5">dep1ver1</tspan></text><line x1="0" y1="21" y2="21" x2="54.359375"></line><text x="5" y="31" fill="white" class="classText"></text><line x1="0" y1="26" y2="26" x2="54.359375"></line><text x="5" y="41" fill="white" class="classText"></text></g><g id="classid-dep2-4" class="classGroup" transform="translate(117.15625,160 )"><rect x="0" y="0" width="33.78125" height="30" class=""></rect><text y="15" x="0"><tspan class="title" x="5">dep2</tspan></text><line x1="0" y1="21" y2="21" x2="33.78125"></line><text x="5" y="31" fill="white" class="classText"></text><line x1="0" y1="26" y2="26" x2="33.78125"></line><text x="5" y="41" fill="white" class="classText"></text></g><g id="classid-dep1ver2-5" class="classGroup" transform="translate(106.8671875,240 )"><rect x="0" y="0" width="54.359375" height="30" class=""></rect><text y="15" x="0"><tspan class="title" x="5">dep1ver2</tspan></text><line x1="0" y1="21" y2="21" x2="54.359375"></line><text x="5" y="31" fill="white" class="classText"></text><line x1="0" y1="26" y2="26" x2="54.359375"></line><text x="5" y="41" fill="white" class="classText"></text></g><path d="M118.9921875,20.67933981727085L103.82942708333333,26.39944984772571C88.66666666666667,32.11955987818057,58.341145833333336,43.559779939090284,43.178385416666664,53.4465566362118C28.015625,63.333333333333336,28.015625,71.66666666666667,28.015625,75.83333333333333L28.015625,80" id="edge0" class="relation" marker-start="url(#compositionStart)"></path><path d="M134.046875,30L134.046875,34.166666666666664C134.046875,38.333333333333336,134.046875,46.666666666666664,134.046875,55C134.046875,63.333333333333336,134.046875,71.66666666666667,134.046875,75.83333333333333L134.046875,80" id="edge1" class="relation" marker-start="url(#compositionStart)"></path><path d="M149.1015625,20.724470850352766L164.125,26.437059041960637C179.1484375,32.14964723356851,209.1953125,43.57482361678425,224.21875,53.45407847505879C239.2421875,63.333333333333336,239.2421875,71.66666666666667,239.2421875,75.83333333333333L239.2421875,80" id="edge2" class="relation dashed-line" marker-end="url(#dependencyEnd)"></path><path d="M134.046875,110L134.046875,114.16666666666667C134.046875,118.33333333333333,134.046875,126.66666666666667,134.046875,135C134.046875,143.33333333333334,134.046875,151.66666666666666,134.046875,155.83333333333334L134.046875,160" id="edge3" class="relation dashed-line" marker-end="url(#dependencyEnd)"></path><path d="M134.046875,190L134.046875,194.16666666666666C134.046875,198.33333333333334,134.046875,206.66666666666666,134.046875,215C134.046875,223.33333333333334,134.046875,231.66666666666666,134.046875,235.83333333333334L134.046875,240" id="edge4" class="relation dashed-line" marker-end="url(#dependencyEnd)"></path></svg></div><p>This setup forces the right version of <code>dep 1</code> to be installed in the root. But there are some restrictions:</p><ol><li>the picked dependency must be devDep. Otherwise the the packages installed through npm registry would have a missing dependency. This could be worked around by adding the dependency to the packages also. But it also means that the dep used in development environment and production environment would be different so you have to carefully sync the versions of the dep.</li><li>the version of the <code>dep 1</code> on which the packages depend must be the same because there can be only 1 version of it to be installed in the root.</li></ol><p>Hope tsserver and the IDEs will have it fixed properly in the near future.</p></div></div></main><footer>© <!-- -->2020<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/post/yarn-workspace";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b7eaa380a7ed2e7f6e7f.js"],"app":["/app-a22ec1c5bb75fda00d04.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-b0556ce5127c1a3e2490.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-a5780fd25427dba554e6.js"],"component---src-pages-contact-tsx":["/component---src-pages-contact-tsx-6e01bfbd9b9e3535a9b7.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-f451d7b1cde1ede15351.js"],"component---src-pages-post-tsx":["/component---src-pages-post-tsx-006378b48e558ceea283.js"],"component---src-template-blog-tsx":["/component---src-template-blog-tsx-dc3e87313bcd461c5423.js"],"component---src-template-resume-tsx":["/component---src-template-resume-tsx-c936ed4b5c03d9e27001.js"]};/*]]>*/</script><script src="/polyfill-b7eaa380a7ed2e7f6e7f.js" nomodule=""></script><script src="/component---src-template-blog-tsx-dc3e87313bcd461c5423.js" async=""></script><script src="/c67bc222f24cf6cac9dade081f06b9686691a306-5cb5fd77d6c6846ab638.js" async=""></script><script src="/app-a22ec1c5bb75fda00d04.js" async=""></script><script src="/d5b08420-07f367315fbba8850a0e.js" async=""></script><script src="/fb7d5399-58798ebfc9c8cc593565.js" async=""></script><script src="/4bdf9057-0bb9c0f56db98bc1f503.js" async=""></script><script src="/framework-beda7bde9d7dca0755ce.js" async=""></script><script src="/webpack-runtime-d10adb79bdd5453eb719.js" async=""></script></body></html>